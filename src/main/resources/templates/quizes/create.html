<head>
    <style>
        html, body {
            overflow: hidden;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<div class="container-fluid">
    <div class="card shadow-lg">
        <div class="card-front">
            <div class="card-header bg-primary text-white d-flex">
                <div class="d-flex justify-content-center flex-grow-1">
                    <h3 class="card-title mb-0">Create Quiz</h3>
                </div>
                <button id="create-with-AI" type="button" class="btn btn-ai">AI
                    <i class="bi bi-arrow-right"></i>
                </button>
            </div>
            <div class="card-body">
                <form th:action="@{/quizes/create}" th:object="${quiz}" method="post" class="needs-validation" novalidate>

                    <h5 class="text-primary">Quiz Information</h5>
                    <div class="row">
                        <div class="col-md-6 mb-1">
                            <label for="quizName" class="form-label fw-bold">Quiz Name</label>
                            <input type="text" id="quizName" th:field="*{name}" class="form-control" placeholder="Enter quiz name" required>
                            <div class="invalid-feedback">Quiz name is required.</div>
                        </div>
                        <div class="col-md-6 mb-1">
                            <label for="quizDescription" class="form-label fw-bold">Description</label>
                            <input type="text" id="quizDescription" th:field="*{description}" class="form-control" placeholder="Enter quiz description" required>
                            <div class="invalid-feedback">Quiz description is required.</div>
                        </div>
                    </div> <!-- Đóng đúng thẻ row -->

                    <h5 class="text-primary mt-4">Schedule</h5>
                    <div class="row">
                        <div class="col-md-6 mb-1">
                            <label for="startTime" class="form-label fw-bold">Start Time</label>
                            <input type="datetime-local" id="startTime" th:field="*{startTime}"
                                   th:value="${param.startTime != null ? param.startTime : #temporals.format(quiz.startTime, 'yyyy-MM-dd''T''HH:mm')}"
                                   class="form-control" required>
                            <div class="invalid-feedback">Start time is required.</div>
                            <div class="text-danger" th:if="${startTimeError}" th:text="${startTimeError}"></div>
                        </div>
                        <div class="col-md-6 mb-1">
                            <label for="endTime" class="form-label fw-bold">End Time</label>
                            <input type="datetime-local" id="endTime" th:field="*{endTime}"
                                   th:value="${param.endTime != null ? param.endTime : #temporals.format(quiz.endTime, 'yyyy-MM-dd''T''HH:mm')}"
                                   class="form-control" required>
                            <div class="invalid-feedback">End time is required.</div>
                            <div class="text-danger" th:if="${endTimeError}" th:text="${endTimeError}"></div>
                        </div>
                    </div> <!-- Đóng đúng thẻ row -->

                    <h5 class="text-primary mt-4">Quiz Settings</h5>
                    <div class="row">
                        <div class="col-md-6 mb-1">
                            <label for="course" class="form-label fw-bold">Course</label>
                            <select id="course" th:field="*{course}" class="form-select" required>
                                <option value="" disabled selected>-- Select a Course --</option>
                                <option th:each="course : ${courses}" th:value="${course.getId()}" th:text="${course.getName()}"></option>
                            </select>
                            <div class="invalid-feedback">Course is required.</div>
                        </div>
                        <div class="col-md-6 mb-1">
                            <label for="attemptLimit" class="form-label fw-bold">Attempt Limit</label>
                            <input type="number" id="attemptLimit" th:field="*{attemptLimit}" class="form-control" placeholder="Enter attempt limit" min="1" required>
                            <div class="invalid-feedback">Attempt limit is required and must be at least 1.</div>
                        </div>
                    </div> <!-- Đóng đúng thẻ row -->

                    <div class="row">
                        <div class="col-md-6 mb-1">
                            <label for="quizType" class="form-label fw-bold">Quiz Type</label>
                            <select id="quizType" th:field="*{quizCategory}" class="form-select" required>
                                <option value="" disabled selected>-- Select Quiz Type --</option>
                                <option value="EXAM">Exam</option>
                                <option value="PRACTICE">Practice</option>
                            </select>
                            <div class="invalid-feedback">Quiz type is required.</div>
                        </div>
                        <div class="col-md-6 mb-1">
                            <label for="createdBy" class="form-label fw-bold">Created By</label>
                            <div id="createdBy" class="border p-2 rounded bg-light">
                                <span th:text="${user.username}"></span>
                            </div>
                            <input type="hidden" th:field="*{createdBy}" th:value="${user.id}" />
                        </div>
                    </div> <!-- Đóng đúng thẻ row -->

                    <h5 class="text-primary mt-4">Tags</h5>
                    <div class="row">
                        <div class="col-md-12 mb-1">
                            <button type="button" class="btn btn-secondary mt-4" data-bs-toggle="modal" data-bs-target="#tagsModal">
                                Manage Tags
                            </button>
                            <span id="selectedTagsCount" class="ms-2 text-muted"></span>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="d-flex justify-content-end mt-4">
                        <button type="submit" class="btn btn-primary btn-lg">Save</button>
                        <a th:href="@{/quizes}" class="btn btn-secondary btn-lg ms-3">Back to List</a>
                    </div>

                </form> <!-- Đóng đúng thẻ form -->

                <!-- Thông báo lỗi / thành công -->
                <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
                <div th:if="${success}" class="alert alert-success mt-3" th:text="${success}"></div>
            </div>
        </div>

        <!-- Add new AI card back -->
        <div class="card-back">
            <div class="card-header bg-primary text-white d-flex">
                <button id="create-manual" type="button" class="btn btn-ai">
                    <i class="bi bi-arrow-left"></i>
                    Manual
                </button>
                <div class="d-flex justify-content-center flex-grow-1">
                    <h3 class="card-title mb-0">Create Quiz</h3>
                </div>
            </div>
            <div class="card-body show-generate-question">
                <input type="text" id="response" name="response" wrap="hard"
                       th:value="${response == null ? '' : response.response}" class="form-control disabled"/>
            </div>
            <div class="card-footer">
                <form id="AIGenerateForm" method="post" th:action="@{/quizes/create/AI}" class="needs-validation"
                      novalidate th:object="${AIRequestBody}">
                    <!-- Warning -->
                    <div class="row mt-2">
                        <div class="col-md-12">
                            <input type="text" id="warning" name="warning" th:value="${warning}"
                                   class="form-control alert alert-warning mb-0 text-center disabled">
                        </div>
                    </div>
                    <!-- AI Input form -->
                    <div class="row mt-2">
                        <div class="col-md-4">
                            <label class="form-label" for="type">Question Type</label>
                            <select class="form-select" id="type" name="type"
                                    aria-label="Enter model" th:field="*{type}" onchange="handleTypeChange()">
                                <option th:each="type :${types}" th:value="${type}"
                                        th:text="${type}"></option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label" for="questionDescription">Question Description</label>
                            <input class="form-control" type="text" id="questionDescription"
                                   name="questionDescription" placeholder="Enter description"
                                   th:field="*{questionDescription}">
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <label class="form-label" for="numOfQuestions">Number of Question</label>
                            <input class="form-control" type="number" id="numOfQuestions" name="numOfQuestions"
                                   placeholder="Enter a number between 1 and 50"/>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="numOfAnswerOptions">Number of Answer Options</label>
                            <select class="form-select" id="numOfAnswerOptions" name="numOfAnswerOptions"
                                    aria-label="Enter model" th:field="*{numOfAnswerOptions}">
                                <option th:each="answerOption : ${numOfAnswerOptions}" th:value="${answerOption}"
                                        th:text="${answerOption}"></option>
                            </select>
                        </div>
                    </div>
                    <!-- Button -->
                    <div class="row mt-3">
                        <div class="col-md-12 d-flex justify-content-end gap-1">
                            <button id="AIgenerate" type="submit" class="btn btn-primary btn-md">Generate</button>
                            <audio id="notificationSound" src="https://cdeneraten.pixabay.com/audio/2024/11/27/audio_9d1bdc20b1.mp3" preload="auto"></audio>
                            <a th:href="@{/quizes}" class="btn btn-secondary btn-md ms-3">Back to List</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal for managing tags -->
<div class="modal fade" id="tagsModal" tabindex="-1" aria-labelledby="tagsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="tagsModalLabel">
                    <i class="fas fa-tags me-2"></i>Manage Tags
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Left column: Search and Create -->
                    <div class="col-md-5 border-end">
                        <!-- Create New Tag -->
                        <form th:action="@{/quizes/tags/create}" method="post" id="createTagForm" class="mb-4" onsubmit="createTag(event)">
                            <div class="input-group">
                                <input type="text" class="form-control" id="tagName" name="name" placeholder="New tag name" required>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Add
                                </button>
                            </div>
                        </form>

                        <!-- Search Tags -->
                        <div class="mb-3">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" class="form-control" id="searchTags"
                                       placeholder="Search tags" oninput="searchTags()">
                            </div>
                        </div>
                    </div>

                    <!-- Right column: Tags List -->
                    <div class="col-md-7">
                        <div class="mb-3">
                            <button type="button" class="btn btn-danger" onclick="deleteSelectedTags()" id="deleteSelectedBtn" disabled>
                                <i class="fas fa-trash-alt me-1"></i>Delete Selected
                                <span class="badge bg-light text-danger ms-1" id="selectedCount">0</span>
                            </button>
                        </div>

                        <div class="tags-scroll" style="max-height: 400px; overflow-y: auto;">
                            <div id="tagsContainer" class="d-flex flex-wrap gap-2">
                                <div th:each="tag : ${tags}" class="tag-item">
                                    <div class="d-flex align-items-center bg-light rounded p-2">
                                        <div class="form-check mb-0">
                                            <input class="form-check-input tag-checkbox" type="checkbox"
                                                   th:id="'tag-' + ${tag.id}"
                                                   th:name="tagIds"
                                                   th:value="${tag.id}"
                                                   onchange="updateDeleteButton()">
                                            <label class="form-check-label"
                                                   th:for="'tag-' + ${tag.id}"
                                                   th:text="${tag.name}">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveSelectedTags()">
                    <i class="fas fa-check me-1"></i>Done
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.tag-item {
    transition: all 0.3s ease;
}

.tag-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.tags-scroll::-webkit-scrollbar {
    width: 6px;
}

.tags-scroll::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.tags-scroll::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

.tags-scroll::-webkit-scrollbar-thumb:hover {
    background: #555;
}

.btn-ai {
    --bs-btn-color: #fff;
    --bs-btn-bg: #0d6efd;
    --bs-btn-border-color: #fff;
    --bs-btn-hover-color: #0d6efd;
    --bs-btn-hover-bg: #fff;
    --bs-btn-hover-border-color: #fff;
    --bs-btn-focus-shadow-rgb: 49, 132, 253;
    --bs-btn-active-color: #fff;
    --bs-btn-active-bg: #0a58ca;
    --bs-btn-active-border-color: #0a53be;
    --bs-btn-active-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
    --bs-btn-disabled-color: #fff;
    --bs-btn-disabled-bg: #0d6efd;
    --bs-btn-disabled-border-color: #0d6efd;
}

.container-fluid {
    perspective: 5000px;
}

.card {
    transition: transform 0.8s;
    transform-style: preserve-3d;
}

.card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
}

.card-back {
    transform: rotateY(180deg);
}

.show-generate-question {
    height: 36vh;
    overflow-y: auto;
}

.disabled {
    pointer-events: none;
}
</style>

<script>
function searchTags() {
    const query = document.getElementById('searchTags').value.trim();
    const tagsContainer = document.getElementById('tagsContainer');

    // Nếu query rỗng, load lại tất cả tags
    if (!query) {
        fetch('/quizes/tags', {
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(handleResponse)
        .then(renderTags)
        .catch(handleError);
        return;
    }

    // Show loading state
    tagsContainer.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';

    fetch(`/quizes/tags/search?name=${encodeURIComponent(query)}`, {
        headers: {
            'Accept': 'application/json'
        }
    })
    .then(handleResponse)
    .then(renderTags)
    .catch(handleError);
}

// Hàm xử lý response
function handleResponse(response) {
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
}

// Hàm render tags
function renderTags(tags) {
    const tagsContainer = document.getElementById('tagsContainer');
    tagsContainer.innerHTML = '';

    if (!tags || tags.length === 0) {
        tagsContainer.innerHTML = '<div class="alert alert-info">No tags found</div>';
        return;
    }

    const tagsArray = Array.isArray(tags) ? tags : [tags];
    tagsArray.forEach(tag => {
        if (tag && tag.id) {
            const sanitizedName = tag.name
                ? tag.name.replace(/[<>]/g, '')
                : 'Unnamed Tag';

            tagsContainer.innerHTML += `
                <div class="tag-item">
                    <div class="d-flex align-items-center bg-light rounded p-2">
                        <div class="form-check mb-0">
                            <input class="form-check-input tag-checkbox" type="checkbox"
                                   id="tag-${tag.id}" name="tagIds" value="${tag.id}"
                                   onchange="updateDeleteButton()">
                            <label class="form-check-label" for="tag-${tag.id}">
                                ${sanitizedName}
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }
    });
    updateDeleteButton();
}

// Hàm xử lý lỗi
function handleError(error) {
    console.error('Error:', error);
    const tagsContainer = document.getElementById('tagsContainer');
    tagsContainer.innerHTML = `
        <div class="alert alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            Unable to load tags. Please try refreshing the page.
        </div>`;
}

function deleteTag(tagId) {
    fetch(`/quizes/tags/delete/${tagId}`, {
        method: 'DELETE'
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(text => {
                throw new Error(text);
            });
        }
        return response.text();
    })
    .then(message => {
        // Tạo thông báo thành công
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            Tag deleted successfully
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        // Thêm thông báo vào modal body
        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);

        // Tự động ẩn thông báo sau 3 giây
        setTimeout(() => {
            alertDiv.remove();
        }, 3000);

        searchTags(); // Refresh the tag list
    })
    .catch(error => {
        // Hiển thị thông báo lỗi
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-exclamation-circle me-2"></i>
            Cannot delete this tag because it is being used in one or more quizzes
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);

        // Tự động ẩn thông báo sau 5 giây
        setTimeout(() => {
            alertDiv.remove();
        }, 5000);
    });
}

function createTag(event) {
    event.preventDefault();
    const formData = new FormData(document.getElementById('createTagForm'));
    fetch('/quizes/tags/create', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(message => {
        // Tạo thông báo thành công
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show';
        alertDiv.innerHTML = `
            <strong>Success!</strong> Tag created successfully.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        // Thêm thông báo vào modal body
        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);

        // Tự động ẩn thông báo sau 3 giây
        setTimeout(() => {
            alertDiv.remove();
        }, 3000);

        document.getElementById('tagName').value = ''; // Xóa input
        searchTags(); // Làm mới danh sách tag
    })
    .catch(error => {
        console.error('Error:', error);
        // Hiển thị thông báo lỗi nếu có
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show';
        alertDiv.innerHTML = `
            <strong>Error!</strong> Failed to create tag.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);
    });
}

function saveSelectedTags() {
    const selectedTags = Array.from(document.querySelectorAll('input[name="tagIds"]:checked'))
        .map(checkbox => ({
            id: checkbox.value,
            name: checkbox.nextElementSibling.textContent.trim()
        }));

    // Store the selected tags in a hidden input field in the main form
    let hiddenInput = document.getElementById('selectedTagsInput');
    if (!hiddenInput) {
        hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'tagIds';
        hiddenInput.id = 'selectedTagsInput';
        document.querySelector('form').appendChild(hiddenInput);
    }
    hiddenInput.value = selectedTags.map(tag => tag.id);

    // Update selected tags display
    const countDisplay = document.getElementById('selectedTagsCount');
    if (selectedTags.length > 0) {
        const tagsList = selectedTags.map(tag =>
            `<span class="badge bg-secondary me-1">${tag.name}</span>`
        ).join('');
        countDisplay.innerHTML = tagsList;
    } else {
        countDisplay.innerHTML = '';
    }

    // Đóng modal sử dụng Bootstrap data-bs-dismiss
    const closeButton = document.querySelector('#tagsModal .btn-secondary[data-bs-dismiss="modal"]');
    if (closeButton) {
        closeButton.click();
    }
}

// Thêm hàm mới để cập nhật trạng thái nút Delete Selected
function updateDeleteButton() {
    const selectedTags = document.querySelectorAll('.tag-checkbox:checked');
    const deleteBtn = document.getElementById('deleteSelectedBtn');
    const selectedCount = document.getElementById('selectedCount');

    deleteBtn.disabled = selectedTags.length === 0;
    selectedCount.textContent = selectedTags.length;
}

// Thay thế hàm deleteSelectedTags hiện tại
async function deleteSelectedTags() {
    const selectedTags = Array.from(document.querySelectorAll('.tag-checkbox:checked'))
        .map(checkbox => ({
            id: checkbox.value,
            name: checkbox.nextElementSibling.textContent.trim()
        }));

    if (selectedTags.length === 0) return;

    if (!confirm(`Are you sure you want to delete ${selectedTags.length} selected tags?`)) {
        return;
    }

    try {
        // Kiểm tra xem có tag nào đang được sử dụng không
        const checkResults = await Promise.all(selectedTags.map(tag =>
            fetch(`/quizes/tags/check/${tag.id}`)
                .then(response => response.json())
                .then(data => ({
                    tagName: tag.name,
                    isUsed: data.isUsed
                }))
        ));

        // Nếu có bất kỳ tag nào đang được sử dụng
        const usedTags = checkResults.filter(result => result.isUsed);
        if (usedTags.length > 0) {
            // Hiển thị thông báo lỗi với danh sách các tag không thể xóa
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-danger alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-exclamation-circle me-2"></i>
                <strong>Cannot delete any tags:</strong><br>
                The following tags are being used in quizzes: "${usedTags.map(tag => tag.tagName).join('", "')}"<br>
                To maintain data integrity, no tags were deleted.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;

            const modalBody = document.querySelector('.modal-body');
            modalBody.insertBefore(alertDiv, modalBody.firstChild);
            setTimeout(() => alertDiv.remove(), 5000);
            return;
        }

        // Nếu không có tag nào đang được sử dụng, tiến hành xóa
        const deleteResults = await Promise.all(selectedTags.map(tag =>
            fetch(`/quizes/tags/delete/${tag.id}`, {
                method: 'DELETE'
            }).then(response => {
                if (!response.ok) throw new Error(`Failed to delete tag: ${tag.name}`);
                return tag.name;
            })
        ));

        // Hiển thị thông báo thành công
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-success alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            Successfully deleted ${deleteResults.length} tags
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);
        setTimeout(() => alertDiv.remove(), 3000);

        // Refresh tag list
        searchTags();
        updateDeleteButton();

    } catch (error) {
        console.error('Error:', error);
        // Hiển thị thông báo lỗi chung
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert alert-danger alert-dismissible fade show';
        alertDiv.innerHTML = `
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong>Error:</strong> Unable to process tag deletion.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

        const modalBody = document.querySelector('.modal-body');
        modalBody.insertBefore(alertDiv, modalBody.firstChild);
        setTimeout(() => alertDiv.remove(), 5000);
    }
}

// Card flip functionality
document.getElementById('create-with-AI').addEventListener('click', function () {
    document.getElementsByClassName('card').item(0).style.transform = 'rotateY(180deg)';
});

document.getElementById('create-manual').addEventListener('click', function () {
    document.getElementsByClassName('card').item(0).style.transform = 'rotateY(0deg)';
});

// Question type handling
function handleTypeChange() {
    var type = document.getElementById('type').value;
    var numOfAnswerOptions = document.getElementById('numOfAnswerOptions');
    switch (type) {
        case "Single Choice Question":
            numOfAnswerOptions.disabled = false;
            break;
        case "True/False Question":
            numOfAnswerOptions.disabled = true;
            numOfAnswerOptions.value = '2';
            break;
    }
}

// Number of questions validation
document.getElementById('numOfQuestions').addEventListener('change', function () {
    if (this.value < 1) {
        this.value = 1;
    } else if (this.value > 50) {
        this.value = 50;
    }
});

// AI Form submission handling
$(document).ready(function () {
    $('#AIGenerateForm').on('submit', function (event) {
        event.preventDefault();
        var formData = $(this).serialize();
        var button = $('#AIgenerate');

        button.html(`
            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
            <span class="" role="status">Generating...</span>
        `);
        button.addClass("disabled");

        $.ajax({
            type: 'POST',
            url: '/quizes/create/AI',
            data: formData,
            success: function (response) {
                $('#response').val(response);
                var notificationSound = document.getElementById("notificationSound");
                notificationSound.play();
                button.html('Generate');
                button.removeClass("disabled");
            },
            error: function (xhr, status, error) {
                console.error('Error: ' + error);
                var notificationSound = document.getElementById("notificationSound");
                notificationSound.play();
                button.html('Generate');
                button.removeClass("disabled");
            }
        });
    });
});
</script>