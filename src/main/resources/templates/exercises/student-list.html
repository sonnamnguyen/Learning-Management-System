<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Exercises List</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <!-- Bootstrap Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #tagContainer {
            max-width: 200px;
            white-space: normal;
            word-wrap: break-word;
            overflow-x: hidden;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .badge {
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 12px;
            margin: 4px;
            display: inline-block;
        }

        .bg-dark {
            background-color: #b5e7a0 !important;
            color: #155724 !important;
        }

        .bg-secondary {
            background-color: #d4edda !important;
            color: #155724 !important;
        }

        #toggleTags {
            cursor: pointer;
            font-weight: bold;
            padding: 8px 14px;
            border-radius: 12px;
            background-color: #a3cfbb !important;
            color: #155724 !important;
            border: none;
        }

        #toggleTags:hover {
            background-color: #8bc5a3 !important;
        }

        /* S·ª≠ d·ª•ng table-bordered ƒë·ªÉ c√≥ ƒë∆∞·ªùng vi·ªÅn gi·ªØa c√°c c·ªôt */
        table.table-bordered th,
        table.table-bordered td {
            border: 1px solid #dee2e6;
        }

        /* D√≤ng ti√™u ƒë·ªÅ v·ªõi m√†u xanh nh·∫°t */
        table.table-bordered thead tr {
            background-color: #e3f2fd; /* M√†u xanh nh·∫°t */
            color: #000;
        }

        .btn-outline-search {
            border: 2px solid #0d6efd; /* Vi·ªÅn m√†u xanh Bootstrap */
            background-color: transparent; /* Kh√¥ng c√≥ m√†u n·ªÅn */
            color: #0d6efd; /* M√†u ch·ªØ m·∫∑c ƒë·ªãnh */
            transition: all 0.3s ease; /* Hi·ªáu ·ª©ng m∆∞·ª£t */
        }

        .btn-outline-search:hover {
            background-color: #0d6efd; /* M√†u n·ªÅn xanh khi hover */
            color: white; /* Ch·ªØ tr·∫Øng khi hover */
        }

        .clear-btn {
            background-color: transparent; /* N·ªÅn trong su·ªët */
            border: 1px solid #ccc; /* Vi·ªÅn x√°m nh·∫π */
            color: #000; /* M√†u ch·ªØ ƒëen */
            transition: background-color 0.3s, color 0.3s; /* Hi·ªáu ·ª©ng m∆∞·ª£t */
        }

        .clear-btn:hover {
            background-color: #6c757d; /* M√†u n·ªÅn x√°m khi hover */
            color: #fff; /* M√†u ch·ªØ tr·∫Øng khi hover */
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        .col-md-6.d-flex .btn {
            height: 38px;
            position: relative;
            top: -10px;
            display: flex;
            align-items: center;
        }

        .col-md-6.d-flex a.btn {
            text-decoration: none;
        }

        .page-item.active .page-link {
            background-color: red;
            border-color: red;
            color: white;
        }

        .page-link {
            color: #007bff; /* M√†u m·∫∑c ƒë·ªãnh cho c√°c li√™n k·∫øt */
        }

        a.d-flex justify-content-end mt-3 {
            position: absolute;
        }

        .card {
            padding-bottom: 10px !important; /* Kho·∫£ng c√°ch d∆∞·ªõi */
            padding-right: 10px !important; /* Kho·∫£ng c√°ch ph·∫£i */
            border-radius: 12px !important; /* Bo g√≥c r√µ h∆°n */
            overflow: hidden !important; /* ƒê·∫£m b·∫£o n·ªôi dung kh√¥ng tr√†n ra ngo√†i */
            box-shadow: 0px 12px 24px rgba(0, 0, 0, 0.2) !important; /* ƒê·ªï b√≥ng nh·∫π h∆°n */
        }

        .card:hover {
            box-shadow: 0px 12px 24px rgba(0, 0, 0, 0.5) !important; /* ƒê·ªï b√≥ng nh·∫π h∆°n */
        }

        .card .d-flex {
            margin-top: auto; /* ƒê∆∞a n√∫t xu·ªëng ƒë√°y card */
            padding-bottom: 10px; /* C√°ch vi·ªÅn d∆∞·ªõi */
            padding-right: 10px; /* C√°ch vi·ªÅn ph·∫£i */
        }

        .card-title {
            display: -webkit-box;
            -webkit-line-clamp: 2; /* Hi·ªÉn th·ªã t·ªëi ƒëa 1 d√≤ng */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.4em; /* C·ªë ƒë·ªãnh chi·ªÅu cao d√≤ng */
            max-height: calc(1.4em * 2); /* ƒê·∫£m b·∫£o ch·ªâ hi·ªÉn th·ªã 2 d√≤ng */
        }

        .description {
            display: -webkit-box;
            -webkit-line-clamp: 1; /* Hi·ªÉn th·ªã t·ªëi ƒëa 1 d√≤ng */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            word-break: break-word;
            overflow-wrap: break-word;
            line-height: 1.4em; /* C·ªë ƒë·ªãnh chi·ªÅu cao d√≤ng */
            max-height: calc(1.4em * 2); /* ƒê·∫£m b·∫£o ch·ªâ hi·ªÉn th·ªã 2 d√≤ng */
        }

        table {
            table-layout: auto !important; /* Gi√∫p c√°c c·ªôt c√≥ k√≠ch th∆∞·ªõc ƒë·ªìng ƒë·ªÅu */
            width: 100%;
            border-collapse: collapse; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c d√≤ng */
            margin: 20px auto;
            max-width: 95%;
        }

        td, th {
            vertical-align: middle; /* CƒÉn gi·ªØa n·ªôi dung */
            height: auto;
            padding: 8px; /* Gi·ªØ kho·∫£ng c√°ch gi·ªØa n·ªôi dung v√† √¥ */
            word-break: normal !important; /* ƒê·∫£m b·∫£o n·ªôi dung kh√¥ng tr√†n */
            white-space: nowrap !important;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;
            max-width: 300px; /* ƒêi·ªÅu ch·ªânh max-width theo nhu c·∫ßu */
        }

        tr {
            height: auto !important;
        }


        <!--
        .table-title {
        --> <!-- position: relative;
        --> <!-- white-space: nowrap;
        --> <!-- overflow: hidden;
        --> <!-- text-overflow: ellipsis;
        --> <!-- max-width: 200 px;
        --> <!-- display: inline-block;
        --> <!-- vertical-align: middle;
        --> <!--
        }

        -->

        .table-title:hover::after {
            content: attr(data-fulltext); /* Hi·ªÉn th·ªã n·ªôi dung ƒë·∫ßy ƒë·ªß */
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px;
            border-radius: 5px;
            white-space: normal;
            max-width: 400px;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
        }

        /* Title */
        th:nth-child(1), td:nth-child(1) {
            width: 25%; /* C·ªôt ti√™u ƒë·ªÅ c√≥ ƒë·ªô r·ªông l·ªõn h∆°n */
        }

        /* Language */
        th:nth-child(2), td:nth-child(2) {
            width: 8%; /* Gi·∫£m b·ªõt ƒë·ªô r·ªông */
            text-align: center;
        }

        /* Difficulty */
        th:nth-child(3), td:nth-child(3) {
            width: 12%;
            text-align: center;
        }

        /* Description */
        th:nth-child(4), td:nth-child(4) {
            width: 45%; /* D√†nh ph·∫ßn l·ªõn kh√¥ng gian cho m√¥ t·∫£ */
        }

        /* Action */
        th:nth-child(5), td:nth-child(5) {
            width: 5%;
            text-align: center;
        }

        .toggle-details i {
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .toggle-details[aria-expanded="true"] i {
            transform: rotate(180deg);
        }

        .warning-list li {
            background-color: #fff9e6;
            border-left: 4px solid #ffd700;
            color: #8b6914;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 6px;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(255, 215, 0, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .warning-list li:hover {
            transform: translateX(5px);
            background-color: #fff5d4;
            box-shadow: 0 3px 8px rgba(255, 215, 0, 0.2);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -48%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .warning-details h3 {
            color: #8b6914;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .warning-details p {
            color: #5c4a1d;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .warning-details .font-weight-bold {
            color: #8b6914;
        }


        .card.card-body {
            border: none;
            padding: 0;
            background: transparent;
        }


        /*Delete Notification*/
        #deleteSuccessToast {
            min-width: 250px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            border-radius: 8px;
            overflow: hidden;
            background-color: #e8f5e9; /* M√†u xanh nh·∫°t gi·ªëng h√¨nh */
            color: #333;
            animation: slideIn 0.3s ease-in-out;
            border-left: 4px solid #2e7d32; /* Vi·ªÅn m√†u xanh ƒë·∫≠m b√™n tr√°i */
        }

        .toast-body {
            padding: 0.75rem 1rem;
            font-weight: 500;
            font-size: 1rem;
        }
    </style>
</head>
<body>
<!-- Wrapper for the whole page -->
<div class="d-flex flex-column min-vh-100">
    <!-- Header -->
    <div th:replace="~{fragments :: header}" class="sticky-top"></div>
    <!-- Main Content -->
    <div class="flex-grow-1 container-fluid mt-5">
        <div class="px-5">
            <!-- Title -->
            <h1 class="text-center mb-4">Exercises for students</h1>

            <!-- Combined Filter and Toolbar Section -->
            <div class="container-fluid mt-4">
                <div class="row gx-2 align-items-center mb-3">
                    <!-- Search Bar and Filters -->
                    <div class="col-md-6">
                        <div class="row gx-2 align-items-center">
                            <!-- Search Input -->
                            <div class="col-9">
                                <form id="filterForm" method="get" action="/exercises" class="row g-3">
                                    <!-- Search Input -->
                                    <div class="col-12">
                                        <label for="searchInput" class="form-label fw-semibold text-muted mb-1">Search
                                            by Title</label>
                                        <div class="input-group">
                                            <input type="text" id="searchInput" name="title"
                                                   class="form-control shadow-sm border-1"
                                                   placeholder="Search by title..." th:value="${paramTitle}">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="bi bi-search me-1"></i> Search
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary ms-2"
                                                    onclick="clearFilters()">
                                                <i class="bi bi-x-circle me-1"></i> Clear
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Filters Row -->
                                    <div class="col-12 mt-2">
                                        <div class="row g-3">
                                            <!-- Language Filter -->
                                            <div class="col-md-4">
                                                <label for="languageFilter"
                                                       class="form-label fw-semibold text-muted mb-1">Language</label>
                                                <select id="languageFilter" name="language"
                                                        class="form-select shadow-sm border-0"
                                                        onchange="this.form.submit()">
                                                    <option value="" th:selected="${currentLanguage == null}">All
                                                        Languages
                                                    </option>
                                                    <option th:each="lang : ${languages}"
                                                            th:value="${lang.id}"
                                                            th:text="${lang.language}"
                                                            th:selected="${lang.id == currentLanguage}">
                                                    </option>
                                                </select>
                                            </div>

                                            <!-- Difficulty Filter -->
                                            <div class="col-md-4">
                                                <label for="levelFilter" class="form-label fw-semibold text-muted mb-1">Difficulty</label>
                                                <select id="levelFilter" name="level"
                                                        class="form-select shadow-sm border-0"
                                                        onchange="this.form.submit()">
                                                    <option value=""
                                                            th:selected="${currentLevel == null or currentLevel == ''}">
                                                        All Levels
                                                    </option>
                                                    <option value="EASY" th:selected="${currentLevel == 'EASY'}">Easy
                                                    </option>
                                                    <option value="MEDIUM" th:selected="${currentLevel == 'MEDIUM'}">
                                                        Medium
                                                    </option>
                                                    <option value="HARD" th:selected="${currentLevel == 'HARD'}">Hard
                                                    </option>
                                                </select>
                                            </div>

                                            <!-- Tag Filter -->
                                            <div class="col-md-4">
                                                <label class="form-label fw-semibold text-muted mb-1">Tags</label>
                                                <div class="dropdown">
                                                    <button class="btn btn-secondary dropdown-toggle w-100"
                                                            type="button"
                                                            id="tagDropdown" data-bs-toggle="dropdown"
                                                            aria-expanded="false">
                                                        Select Tags
                                                    </button>
                                                    <div class="dropdown-menu p-2"
                                                         style="max-height: 350px; overflow-y: auto; width: 100%;">

                                                        <!-- üîç Thanh t√¨m ki·∫øm v·ªõi n√∫t Submit -->
                                                        <div class="input-group mb-2">
                                                            <input type="text" class="form-control" id="tagSearch"
                                                                   placeholder="Search tags...">
                                                        </div>

                                                        <!-- ‚úÖ Danh s√°ch tag -->
                                                        <div class="d-flex flex-column gap-2" id="tagList">
                                                            <div th:each="tag : ${tags}" class="form-check">
                                                                <input class="form-check-input tag-checkbox"
                                                                       type="checkbox"
                                                                       th:id="'tag-' + ${tag.id}"
                                                                       name="tags" th:value="${tag.id}"
                                                                       th:checked="${selectedTags != null and selectedTags.contains(tag.id)}">
                                                                <label class="form-check-label"
                                                                       th:for="'tag-' + ${tag.id}"
                                                                       th:text="${tag.tag}"></label>
                                                            </div>
                                                        </div>

                                                        <!-- üîò N√∫t Search n·∫±m trong dropdown -->
                                                        <button type="submit" class="btn btn-success w-100 mt-2">Apply Filter</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Switch to Table View Button -->
                    <div class="col-md-6 d-flex flex-column align-items-end">
                        <div class="d-flex justify-content-end align-items-center mt-5">
                            <!-- Button Dashboard -->
                            <a href="/exercises/student-dashboard" class="btn btn-outline-primary btn-sm border">
                                <i class="bi bi-speedometer2 me-2"></i> Dashboard
                            </a>
                            <!-- Button Switch view card -->
                            <button id="toggleView" class="btn btn-primary btn-sm ms-2">
                                <i class="bi bi-table"></i> Switch to Table View
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Table View-->
        <div id="tableView" class="table-responsive">
            <table class="table table-hover table-bordered">
                <thead>
                <tr>
                    <th style="width: 20%;">Title</th>
                    <th class="text-center" style="width: 10%;">Language</th>
                    <th class="text-center" style="width: 10%;">Difficulty</th>
                    <th style="width: 40%;">Description</th>
                    <th style="width: 10%;">Tag</th>
                    <th class="text-center" style="width: 15%;">Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="exercise : ${exercises}" th:attr="data-id=${exercise.id}">
                    <td class="table-title" th:text="${exercise.name}"
                        th:attr="data-fulltext=${exercise.name}"></td>
                    <td class="text-center" th:text="${exercise.language.language}">Language</td>
                    <td class="text-center">
                            <span th:class="${'badge ' + (exercise.level.name() == 'HARD' ? 'bg-danger' :
                                     (exercise.level.name() == 'MEDIUM' ? 'bg-warning' : 'bg-success'))}"
                                  th:text="${exercise.level}">
                            </span>
                    </td>
                    <td>
                        <div class="description" th:utext="${exercise.description}"></div>
                    </td>
                    <td>
                        <div id="tagContainer">
                        <span th:each="tag, iterStat : ${exercise.exerciseCategories}"
                              th:text="${tag.category.tag}"
                              th:classappend="${iterStat.index >= 2} ? 'd-none extra-tag'"
                              class="badge bg-dark text-light me-2">
                        </span>
                            <span th:if="${#lists.size(exercise.exerciseCategories) > 2}"
                                  id="toggleTags" class="badge bg-secondary text-light"
                                  role="button" onclick="toggleTags()">...</span>
                        </div>
                    </td>
                    <td class="text-center">
                        <a th:href="@{'/judgement/practice/code_space/' + ${exercise.id}}"
                           class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-file-text"></i>
                        </a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(exercises)}">
                    <td colspan="6" class="text-center">No exercises found.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Card View -->
        <div id="cardView" class="row row-cols-1 row-cols-md-3 g-3 mt-3" style="display: block;">
            <div class="col" th:each="exercise : ${exercises}">
                <div class="card h-100 border-secondary shadow-sm d-flex flex-column">
                    <div class="card-body flex-grow-1">
                        <h5 class="card-title fw-bold text-primary" th:text="${exercise.name}">Exercise Title</h5>
                        <p class="mb-1"><strong>Language:</strong>
                            <span class="text-muted" th:text="${exercise.language.language}">Java</span>
                        </p>
                        <p class="mb-1">
                            <strong>Difficulty:</strong>
                            <span th:class="${'badge ' + (exercise.level.name() == 'HARD' ? 'bg-danger' :
                         (exercise.level.name() == 'MEDIUM' ? 'bg-warning' : 'bg-success'))}"
                                  th:text="${exercise.level}">
                                </span>
                        </p>
                        <p class="mb-2"><strong>Description:</strong>
                            <span class="description" th:utext="${exercise.description}"></span>
                        </p>
                        <p class="mb-2"><strong>Tags:</strong>
                            <span th:each="tag : ${exercise.exerciseCategories}"
                                  class="badge bg-dark text-light me-2"
                                  th:text="${tag.category.tag}">
                                </span>

                        </p>
                    </div>

                    <!-- C√°c n√∫t ƒë∆∞·ª£c cƒÉn d∆∞·ªõi c√πng v·ªõi kho·∫£ng c√°ch 10px -->
                    <div class="d-flex justify-content-end mt-auto" style="padding-bottom: 10px;">
                        <a th:href="@{'/judgement/practice/code_space/' + ${exercise.id}}"
                           class="btn btn-outline-primary btn-sm me-2">
                            <i class="bi bi-file-text"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div th:if="${#lists.isEmpty(exercises)}"
                 class="d-flex justify-content-center align-items-center"
                 style="height: 50px; width: 100%;">
                <p>No exercises found.</p>
            </div>

        </div>


        <!-- Pagination -->
        <div class="d-flex justify-content-center mt-4" th:if="${totalPages >= 1}">
            <nav>
                <ul class="pagination">
                    <!-- Tr∆∞·ªùng h·ª£p ch·ªâ c√≥ 1 trang -->
                    <th:block th:if="${totalPages == 1}">
                        <li class="page-item active">
                            <a class="page-link" href="#">1</a>
                        </li>
                    </th:block>
                    <!-- Tr∆∞·ªùng h·ª£p c√≥ nhi·ªÅu h∆°n 1 trang -->
                    <th:block th:if="${totalPages > 1}">
                        <!-- N√∫t First (<<) -->
                        <li class="page-item" th:if="${currentPage > 0}">
                            <a class="page-link"
                               th:href="@{/exercises(page=0, language=${currentLanguage}, level=${currentLevel}, description=${paramDescription}, title=${paramTitle})}">¬´</a>
                        </li>
                        <!-- N√∫t Previous (<) -->
                        <li class="page-item" th:if="${currentPage > 0}">
                            <a class="page-link"
                               th:href="@{/exercises(page=${currentPage - 1}, language=${currentLanguage}, level=${currentLevel}, description=${paramDescription}, title=${paramTitle})}"><</a>
                        </li>
                        <!-- Tr∆∞·ªùng h·ª£p c√≥ t·ª´ 2 ƒë·∫øn 3 trang: hi·ªÉn th·ªã t·∫•t c·∫£ s·ªë trang -->
                        <th:block th:if="${totalPages <= 3}">
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link"
                                   th:href="@{/exercises(page=${i}, language=${currentLanguage}, level=${currentLevel}, title=${paramTitle}, description=${paramDescription})}"
                                   th:text="${i + 1}">Page</a>
                            </li>
                        </th:block>
                        <!-- Tr∆∞·ªùng h·ª£p c√≥ nhi·ªÅu h∆°n 3 trang: gi·ªØ logic hi·ªán t·∫°i -->
                        <th:block th:if="${totalPages > 3}">
                            <th:block th:with="isNearStart=${currentPage == 0},
                          isNearEnd=${currentPage >= totalPages - 3},
                          startPage=${isNearStart ? 0 : (isNearEnd ? totalPages - 3 : currentPage)},
                          startPage=${T(java.lang.Math).max(0, startPage)},
                          endPage=${T(java.lang.Math).min(startPage + 2, totalPages - 1)}">
                                <!-- Trang ƒë·∫ßu ti√™n (ch·ªâ hi·ªÉn th·ªã n·∫øu ·ªü g·∫ßn cu·ªëi) -->
                                <li class="page-item" th:if="${isNearEnd}"
                                    th:classappend="${currentPage == 0} ? 'active'">
                                    <a class="page-link"
                                       th:href="@{/exercises(page=0, language=${currentLanguage}, level=${currentLevel}, title=${paramTitle}, description=${paramDescription})}">1</a>
                                </li>
                                <!-- D·∫•u ba ch·∫•m n·∫øu c·∫ßn (tr∆∞·ªõc c√°c trang ch√≠nh) -->
                                <li class="page-item disabled" th:if="${isNearEnd and startPage > 1}">
                                    <span class="page-link">...</span>
                                </li>
                                <!-- Hi·ªÉn th·ªã t·ªëi ƒëa 3 trang t·ª´ startPage -->
                                <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}"
                                    th:classappend="${i == currentPage} ? 'active'">
                                    <a class="page-link"
                                       th:href="@{/exercises(page=${i}, language=${currentLanguage}, level=${currentLevel}, title=${paramTitle}, description=${paramDescription})}"
                                       th:text="${i + 1}">Page</a>
                                </li>
                                <!-- D·∫•u ba ch·∫•m n·∫øu c·∫ßn (sau c√°c trang ch√≠nh) -->
                                <li class="page-item disabled" th:if="${endPage < totalPages - 1 and !isNearEnd}">
                                    <span class="page-link">...</span>
                                </li>
                                <!-- Trang cu·ªëi c√πng (hi·ªÉn th·ªã n·∫øu kh√¥ng ·ªü g·∫ßn cu·ªëi) -->
                                <li class="page-item" th:if="${endPage < totalPages - 1 and !isNearEnd}"
                                    th:classappend="${currentPage == totalPages - 1} ? 'active'">
                                    <a class="page-link"
                                       th:href="@{/exercises(page=${totalPages - 1}, language=${currentLanguage}, level=${currentLevel}, title=${paramTitle}, description=${paramDescription})}"
                                       th:text="${totalPages}">Last</a>
                                </li>
                            </th:block>
                        </th:block>
                        <!-- N√∫t Next (>) -->
                        <li class="page-item" th:if="${currentPage < totalPages - 1}">
                            <a class="page-link"
                               th:href="@{/exercises(page=${currentPage + 1}, language=${currentLanguage}, level=${currentLevel}, description=${paramDescription}, title=${paramTitle})}">></a>
                        </li>
                        <!-- N√∫t Last (>>) -->
                        <li class="page-item" th:if="${currentPage < totalPages - 1}">
                            <a class="page-link"
                               th:href="@{/exercises(page=${totalPages - 1}, language=${currentLanguage}, level=${currentLevel}, description=${paramDescription}, title=${paramTitle})}">¬ª</a>
                        </li>
                    </th:block>
                    <!-- √î nh·∫≠p s·ªë trang -->
                    <div class="input-group input-group-sm ms-2 page-item" style="width: 130px;">
                        <input type="text" class="form-control" id="pageInput"
                               th:attr="max=${totalPages}, min=1"
                               placeholder="Go to"
                               style="text-align: center;">
                        <button class="btn btn-outline-primary" type="button" onclick="goToPage()">‚©•</button>
                    </div>
                </ul>
            </nav>
        </div>
    </div>
</div>

<div id="deleteSuccessToast" class="toast position-fixed" role="alert"
     aria-live="assertive" aria-atomic="true" style="z-index: 1050; display: none; top: 70px; right: 20px;">
    <div class="toast-body text-center">
        Deleted Successfully!
    </div>
</div>

<!-- Footer -->
<div th:replace="~{fragments :: footer}" class="mt-auto"></div>
<!-- Limit description in 20 words -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.description').forEach(desc => {
            let text = desc.innerText;
            if (text.length > 70) {
                desc.innerText = text.substring(0, 70) + "...";
            }
        });
    });

</script>
<!-- Switch card and table -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let viewMode = localStorage.getItem("viewMode") || "card"; // M·∫∑c ƒë·ªãnh Card View
        updateView(viewMode);

        document.getElementById("toggleView").addEventListener("click", function () {
            viewMode = (viewMode === "card") ? "table" : "card";
            localStorage.setItem("viewMode", viewMode);
            updateView(viewMode);
        });
    });

    function updateView(mode) {
        let toggleButton = document.getElementById("toggleView");

        if (mode === "card") {
            document.getElementById("cardView").style.display = "flex";
            document.getElementById("tableView").style.display = "none";
            toggleButton.innerHTML = '<i class="bi bi-table me-2"></i> Switch to Table View';
            toggleButton.classList.replace("btn-secondary", "btn-primary");
        } else {
            document.getElementById("cardView").style.display = "none";
            document.getElementById("tableView").style.display = "block";
            toggleButton.innerHTML = '<i class="bi bi-grid me-2"></i> Switch to Card View';
            toggleButton.classList.replace("btn-primary", "btn-secondary");
        }
    }
</script>
<!-- Bootstrap 5 JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const selectAllCheckbox = document.getElementById("selectAll");
        const itemCheckboxes = document.querySelectorAll(".selectItem");
        const deleteButton = document.getElementById("deleteSelected");
        const toastElement = document.getElementById("deleteSuccessToast");
        const importResultModal = new bootstrap.Modal(document.getElementById("importResultModal"));

        // Ki·ªÉm tra n·∫øu c√≥ th√¥ng b√°o th√†nh c√¥ng ho·∫∑c c·∫£nh b√°o th√¨ hi·ªÉn th·ªã modal
        // if (document.querySelector(".alert-success") || document.querySelector(".alert-warning")) {
        //     importResultModal.show();
        // }

        if (document.querySelector("#importResultModal .alert")) {
            importResultModal.show();
        }

        function setupAlertAutoDismiss(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                setTimeout(() => {
                    closeAlert(alertId);
                }, 3000);
            }
        }

        function closeAlert(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.style.animation = 'fadeOut 0.5s ease-out forwards';
                setTimeout(() => {
                    alert.remove();
                }, 2000);
            }
        }

        // Setup auto-dismiss for both alerts
        setupAlertAutoDismiss('successAlert');
        setupAlertAutoDismiss('errorAlert');


        // Ch·ªçn t·∫•t c·∫£ checkbox
        selectAllCheckbox.addEventListener("change", function () {
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        // N·∫øu b·ªè ch·ªçn m·ªôt checkbox, b·ªè ch·ªçn "Select All"
        itemCheckboxes.forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                selectAllCheckbox.checked = [...itemCheckboxes].every(cb => cb.checked);
            });
        });

        // X·ª≠ l√Ω khi nh·∫•n n√∫t "Delete Selected"
        deleteButton.addEventListener("click", function () {
            const selectedIds = [...document.querySelectorAll(".selectItem:checked")]
                .map(cb => cb.closest("tr").getAttribute("data-id"));

            if (selectedIds.length === 0) {
                alert("No exercises selected.");
                return;
            }

            if (confirm("Are you sure you want to delete selected exercises?")) {
                fetch('/exercises/delete-batch', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ids: selectedIds})
                }).then(response => {
                    if (response.ok) {
                        showToast();
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        alert("Failed to delete exercises.");
                    }
                });
            }
        });

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showToast() {
            toastElement.style.display = "block";
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
        }
    });
    document.addEventListener("DOMContentLoaded", function () {
        const languageFilter = document.getElementById("languageFilter");
        const levelFilter = document.getElementById("levelFilter");
        const filterForm = document.getElementById("filterForm");

        // Submit form khi thay ƒë·ªïi dropdown
        languageFilter.addEventListener("change", function () {
            filterForm.submit();
        });

        levelFilter.addEventListener("change", function () {
            filterForm.submit();
        });

    });

    function clearFilters() {
        // Clear the dropdowns and input
        document.getElementById('languageFilter').value = '';
        document.getElementById('levelFilter').value = '';
        document.getElementById('searchInput').value = '';

        // Submit the form without filters
        document.getElementById('filterForm').submit();
    }

    // Close popup when clicking outside
    document.getElementById('overlay').addEventListener('click', function () {
        document.querySelectorAll('.warning-details.active').forEach(detail => {
            detail.classList.remove('active');
        });
        this.classList.remove('active');
    });

    // function toggleTags() {
    //     document.querySelectorAll('.extra-tag').forEach(tag => {
    //         tag.classList.toggle('d-none');
    //     });
    // }
    function toggleTags() {
        let extraTags = document.querySelectorAll('.extra-tag');
        extraTags.forEach(tag => tag.classList.toggle('d-none'));

        let toggleBtn = document.getElementById('toggleTags');
        toggleBtn.textContent = toggleBtn.textContent === "..." ? "Show less" : "...";
    }

    // tag
    function updateSelectedTags() {
        selectedTagsContainer.innerHTML = '';
        let selectedCount = 0;
        let selectedTags = [];

        tagCheckboxes.forEach(checkbox => {
            if (checkbox.checked) {
                selectedCount++;
                selectedTags.push(checkbox.value);
                const tag = document.createElement('span');
                tag.className = 'selected-tag';
                const label = checkbox.nextElementSibling.textContent;
                tag.innerHTML = `${label} <span class="remove-tag" data-id="${checkbox.value}">&times;</span>`;
                selectedTagsContainer.appendChild(tag);
            }
        });

        dropdownButton.textContent = selectedCount > 0 ? `${selectedCount} tag(s) selected` : 'Select Tags';

        // Update form's hidden input for tags
        let form = document.getElementById('filterForm');
        // Remove existing tag inputs
        form.querySelectorAll('input[name="tags"]').forEach(input => {
            if (!input.checked) {
                input.remove();
            }
        });

        // Add selected tags as hidden inputs
        selectedTags.forEach(tagId => {
            if (!form.querySelector(`input[name="tags"][value="${tagId}"]`)) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'tags';
                input.value = tagId;
                form.appendChild(input);
            }
        });
    }

    tagCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            updateSelectedTags();
            document.getElementById('filterForm').submit();
        });
    });

    selectedTagsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-tag')) {
            const tagId = e.target.dataset.id;
            const checkbox = document.querySelector(`input[value="${tagId}"]`);
            if (checkbox) {
                checkbox.checked = false;
                updateSelectedTags();
                document.getElementById('filterForm').submit();
            }
        }
    });

    // Initialize selected tags
    updateSelectedTags();

    function toggleTags() {
        let extraTags = document.querySelectorAll('.extra-tag');
        extraTags.forEach(tag => tag.classList.toggle('d-none'));

        let toggleBtn = document.getElementById('toggleTags');
        toggleBtn.textContent = toggleBtn.textContent === "..." ? "Show less" : "...";
    }
</script>
<script>
    document.getElementById("filterForm").addEventListener("submit", function () {
        let checkedTags = [];
        document.querySelectorAll("input[name='tags']:checked").forEach(tag => {
            checkedTags.push(tag.value);
        });
        console.log("Selected Tags:", checkedTags);
    });

    document.getElementById("tagSearch").addEventListener("input", function () {
        let filter = this.value.toLowerCase();
        let tags = document.querySelectorAll("#tagList .form-check");

        tags.forEach(tag => {
            let label = tag.querySelector("label").innerText.toLowerCase();
            tag.style.display = label.includes(filter) ? "block" : "none";
        });
    });

    // üîç Khi nh·∫•n n√∫t "üîç", l·ªçc tag theo input
    document.getElementById("submitTagSearch").addEventListener("click", function () {
        let searchInput = document.getElementById("tagSearch");
        let event = new Event("input");
        searchInput.dispatchEvent(event);
    });
</script>
<script th:inline="javascript">
    function goToPage() {
        var pageInput = document.getElementById('pageInput').value.trim(); // L·∫•y chu·ªói g·ªëc v√† lo·∫°i b·ªè kho·∫£ng tr·∫Øng th·ª´a
        var totalPages = /*[[${totalPages}]]*/ 0;
        var currentLanguage = /*[[${currentLanguage}]]*/ null;
        var currentLevel = /*[[${currentLevel}]]*/ '' || '';
        var paramTitle = /*[[${paramTitle}]]*/ '' || '';

        // Ki·ªÉm tra n·∫øu chu·ªói r·ªóng
        if (!pageInput) {
            showError('Please enter a page number.');
            return;
        }

        // Ki·ªÉm tra xem chu·ªói c√≥ ph·∫£i l√† s·ªë nguy√™n d∆∞∆°ng h·ª£p l·ªá kh√¥ng
        if (!/^\d+$/.test(pageInput)) {
            // Ki·ªÉm tra n·∫øu chu·ªói ch·ª©a c·∫£ ch·ªØ v√† s·ªë
            if (/[a-zA-Z]/.test(pageInput) && /[0-9]/.test(pageInput)) {
                showError('Your input contains both letters and numbers. Please enter only numbers.');
                return;
            }
            // Ki·ªÉm tra n·∫øu chu·ªói ch·ªâ ch·ª©a ch·ªØ c√°i
            if (/^[a-zA-Z]+$/.test(pageInput)) {
                showError('Your input contains letters. Please enter only numbers.');
                return;
            }
            // Ki·ªÉm tra n·∫øu chu·ªói l√† s·ªë th·∫≠p ph√¢n
            if (/^\d*\.\d+$/.test(pageInput)) {
                showError('Your input is a decimal number. Please enter an integer.');
                return;
            }
            // Ki·ªÉm tra n·∫øu chu·ªói ch·ª©a k√Ω t·ª± ƒë·∫∑c bi·ªát
            if (/[^0-9]/.test(pageInput)) {
                showError('Your input contains special characters. Please enter only numbers.');
                return;
            }
        }

        // ƒê·∫øn ƒë√¢y, pageInput l√† s·ªë nguy√™n d∆∞∆°ng h·ª£p l·ªá
        var page = parseInt(pageInput) - 1; // Chuy·ªÉn th√†nh s·ªë v√† tr·ª´ 1 v√¨ page b·∫Øt ƒë·∫ßu t·ª´ 0

        // Ki·ªÉm tra n·∫øu page n·∫±m trong ph·∫°m vi h·ª£p l·ªá
        if (page >= 0 && page < totalPages) {
            var url = '/exercises?page=' + page;
            if (currentLanguage !== null && currentLanguage !== undefined && currentLanguage !== '') {
                url += '&language=' + encodeURIComponent(currentLanguage);
            }
            if (currentLevel) url += '&level=' + encodeURIComponent(currentLevel);
            if (paramTitle) url += '&title=' + encodeURIComponent(paramTitle);
            window.location.href = url;
        } else {
            showError('Please enter a page number between 1 and ' + totalPages);
        }
    }

    // H√†m hi·ªÉn th·ªã th√¥ng b√°o l·ªói
    function showError(message) {
        Swal.fire({
            icon: 'warning',
            title: 'Invalid Input!',
            text: message,
            timer: 10000,  // T·ª± ƒë·ªông ƒë√≥ng sau 10 gi√¢y
            timerProgressBar: true,  // Hi·ªÉn th·ªã thanh th·ªùi gian ch·∫°y
            showConfirmButton: false, // ·∫®n n√∫t "OK"
        }).then((result) => {
            document.getElementById('pageInput').value = '';
            document.getElementById('pageInput').focus();
        });
    }

    // G·∫Øn s·ª± ki·ªán Enter
    document.getElementById('pageInput').addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            goToPage();
        }
    });
</script>

</body>
</html>